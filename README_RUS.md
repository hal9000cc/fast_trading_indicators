# live_trading_indicators
Пакет для получения данных котировок из различных источников онлайн и расчета на основе этих котировок значений технических индикаторов.
Запрос и загрузка данных происходит автоматически. Возможно получение данных в реальном времени. Полученые данные сохраняются в файловом кэше с возможностью их быстрого использования. Производится тщательный контроль целостности данных.

Текущая версия позволяет получать данные биржи **Binance** (**spot**, **futures USD-M**, **futures COIN-M**).

Данные можно получить в виде numpy ndarray и Dataframe Pandas.

Папка данных пакета по умолчанию .lti в домашней папке пользователя. В этой папке может создаваться значительный объем данных, в зависимости от количества инструментов и их таймфреймов.

## Примеры использования
### Получение котировок
```python
import live_trading_indicators as lti

indicators = lti.Indicators('binance')
ohlcv = indicators.OHLCV('ethusdt', '4h', '2022-07-01', '2022-07-01')
print(ohlcv)
```
###### Результат:
```
<OHLCV data> symbol: ethusdt, timeframe: 4h
date: 2022-07-01T00:00 - 2022-07-01T20:00 (length: 6) 
empty bars: count 0 (0.00 %), max consecutive 0
Values: time, open, high, low, close, volume
```

Теперь ohlcv содержит котировки в виде numpy array (ohlcv.time, ohlcv.open, ohlcv.high, ohlcv.low, ohlcv.close, ohlcv.volume).

### pandas dataframe
```python
dataframe = ohlcv.pandas()
print(dataframe.head())
```
###### Результат:
```
                 time     open     high      low    close       volume
0 2022-07-01 00:00:00  1071.02  1117.00  1050.46  1054.52  430646.8720
1 2022-07-01 04:00:00  1054.52  1076.43  1045.41  1066.81  275557.9328
2 2022-07-01 08:00:00  1066.81  1086.44  1033.44  1050.22  252105.5665
3 2022-07-01 12:00:00  1050.21  1074.23  1043.00  1056.86  298465.0695
4 2022-07-01 16:00:00  1056.86  1083.10  1054.82  1067.91  158796.2248
```
### Пример получения иданных ндикатора
```python
macd = indicators.MACD('ethusdt', '1h', '2022-07-01', '2022-07-30', period_short=15, period_long=26, period_signal=9)
print(macd.pandas().head())
```
###### Результат:
```
                 time      macd  macd_signal  macd_hist
0 2022-07-01 00:00:00  0.000000     0.000000   0.000000
1 2022-07-01 01:00:00  0.021389     0.010694   0.010694
2 2022-07-01 02:00:00 -0.061712    -0.013441  -0.048271
3 2022-07-01 03:00:00 -1.105457    -0.286445  -0.819012
4 2022-07-01 04:00:00 -2.146765    -0.658509  -1.488256
```
### Получение данных в реальном времени (последние 3 минуты на таймфрейме 1m без неполного бара)
Для получения данных в реальном времени необходимо не указывать конечную дату.
```python
import datetime as dt
import live_trading_indicators as lti

utcnow = dt.datetime.utcnow()
print(f'Now is {utcnow} UTC')
indicators = lti.Indicators('binance', utcnow - dt.timedelta(minutes=3))
ohlcv = indicators.OHLCV('btcusdt', '1m')
print(ohlcv.pandas())
```
###### Результат:
```
Now is 2022-11-04 09:32:31.528230 UTC
                 time      open      high       low     close     volume
0 2022-11-04 09:29:00  20594.39  20595.60  20591.06  20592.38  177.35380
1 2022-11-04 09:30:00  20592.38  20600.98  20591.75  20600.30  178.40869
2 2022-11-04 09:31:00  20600.98  20623.93  20600.30  20621.45  431.11917
```
### Получение данных в реальном времени (последние 3 минуты на таймфрейме 1m плюс неполный бар)
Для получения последнего, незавершенного бара необходимо указать *with_incomplete_bar=True* при создании *Indicators*
```python
utcnow = dt.datetime.utcnow()
print(f'Now is {utcnow} UTC')
indicators = lti.Indicators('binance', utcnow - dt.timedelta(minutes=3), with_incomplete_bar=True)
ohlcv = indicators.OHLCV('btcusdt', '1m')
print(ohlcv.pandas())
```
###### Результат:
```
Now is 2022-11-04 09:37:07.372986 UTC
2022-11-04 12:37:07,374 Download using api symbol btcusdt timeframe 1m from 2022-11-04T00:00:00.000...
                 time      open      high       low     close     volume
0 2022-11-04 09:34:00  20614.55  20618.50  20610.76  20615.97  263.96754
1 2022-11-04 09:35:00  20615.61  20624.00  20610.29  20616.53  258.53777
2 2022-11-04 09:36:00  20615.69  20617.75  20609.74  20611.46  199.43313
3 2022-11-04 09:37:00  20611.11  20611.89  20608.17  20609.02   15.15800
```
## Подробнее
Поддерживаются все типовые тамфреймы до 1 суток включительно: 1m, 5m, 15m, 30m, 1h, 2h, 4h, 6h, 8h, 12h, 1d.
По умолчанию сообщения лога выводятся в консоль, и вы увидите подобные сообщения:
```
2022-11-04 12:32:31,528 Download using api symbol btcusdt timeframe 1m from 2022-11-04T00:00:00.000...
```
Для их отключения нужно выполнить следующий код и перезапустить python.
```python
import live_trading_indicators as lti
lti.config(print_log=False)
```
### Индикаторы
При получении значений индикаторов превые два параметра symbol и timeframe. Далее опционально может быть указан период. Затем указываются параметры индикатора по именам.
#### Примеры
```python
sma = indicators.MACD('ethusdt', '1h', period=9)
macd = indicators.MACD('ethusdt', '1h', '2022-07-01', '2022-07-30', period_short=15, period_long=26, period_signal=9)
```
Реализованы следующие индикаторы (пропущены для краткости *symbol*, *timeframe*, *time_start*, *time_end*):
- EMA(period, value='close')
- SMA(period, value='close')
- MA(period, value='close', ma_type='sma')
- MACD(period_short, period_long, period_signal)
- RSI(period, value='close')
### Указание периода
Период может быть указан как при иницилизации *Indicators*, так и в параметрах индикатора. Тип данных при указании периода может быть *datetime.date*, *datetime.datetime*, *numpy.datetime64*, строка, или число в формате *YYYYMMDD*.
Существуют три стратегии указания периода времени.
#### 1. Период времени указывается при создании Indicators (базовый период)
Значения индикаторов можно получить за любой период в пределах интервала, заданного для *Indicators*. При выходе за указанный интервал будет сгенерировано исключение *LTIExceptionOutOfThePeriod*.
##### Пример
```python
indicators = lti.Indicators('binance', 20220901, 20220930) # базовый период
ohlcv = indicators.OHLCV('um/ethusdt', '1h') # период не указан, используется базовый период
sma22 = indicators.SMA('um/ethusdt', '1h', 20220905, 20220915, period=22) # период указан
sma15 = indicators.SMA('um/ethusdt', '1h', 20220905, 20221015, period=15) # ОШИБКА, выход за границы базового периода
```
#### 2. Период времени не указывается при создании Indicators
В этом варианте, при получении данных индикатора, период надо указывать всегда. Период времени для расчета значений индикаторов определяется автоматически. При расширении интервала может происходить обновление данных, это может замедлять работу.
##### Пример
```python
indicators = lti.Indicators('binance') # период не указан
ohlcv = indicators.OHLCV('um/ethusdt', '1h', 20220801, 20220815) # период указывать обязательно
ma22 = indicators.SMA('um/ethusdt', '1h', 'close', 22, 20220905, 20220915) # период указывать обязательно
```
#### 3. Режим реального времени
В этом варианте не указывается конечная дата. Данные всегда получаются по текущий момент.
При создании Indicators можно указать with_incomplete_bar=True, тогда будут получены данные последнего, не завершенного бара.
