# live_trading_indicators
Пакет для получения данных котировок из различных источников онлайн и расчета на основе этих котировок значений технических индикаторов.
Запрос и загрузка данных происходит автоматически. Возможно получение данных в реальном времени. Полученые данные сохраняются в файловом кэше с возможностью их быстрого использования. Производится тщательный контроль целостности данных.

Текущая версия позволяет получать данные биржи binance (spot, futures USD-M, futures COIN-M).

Данные можно получить в виде numpy ndarray и Dataframe Pandas.

Папка данных пакета по умолчанию .lti в домашней папке пользователя. В этой папке может создаваться значительный объем данных, в зависимости от количества инструментов и их таймфреймов.

## Примеры использования
### Получение котировок
```python
import live_trading_indicators as lti

indicators = lti.Indicators('binance')
ohlcv = indicators.OHLCV('ethusdt', '4h', '2022-07-01', '2022-07-01')
print(ohlcv)
```
###### Результат:
```
<OHLCV data> symbol: ethusdt, timeframe: 4h
date: 2022-07-01T00:00 - 2022-07-01T20:00 (length: 6) 
empty bars: count 0 (0.00 %), max consecutive 0
Values: time, open, high, low, close, volume
```

Теперь ohlcv содержит котировки в виде numpy array (ohlcv.time, ohlcv.open, ohlcv.high, ohlcv.low, ohlcv.close, ohlcv.volume).

### pandas dataframe
```python
dataframe = ohlcv.pandas()
print(dataframe.head())
```
###### Результат:
```
                 time     open     high      low    close       volume
0 2022-07-01 00:00:00  1071.02  1117.00  1050.46  1054.52  430646.8720
1 2022-07-01 04:00:00  1054.52  1076.43  1045.41  1066.81  275557.9328
2 2022-07-01 08:00:00  1066.81  1086.44  1033.44  1050.22  252105.5665
3 2022-07-01 12:00:00  1050.21  1074.23  1043.00  1056.86  298465.0695
4 2022-07-01 16:00:00  1056.86  1083.10  1054.82  1067.91  158796.2248
```
### MACD индикатор
```python
macd = indicators.MACD('ethusdt', '1h', '2022-07-01', '2022-07-30', period_short=15, period_long=26, period_signal=9)
print(macd.pandas().head())
```
###### Результат:
```
                 time      macd  macd_signal  macd_hist
0 2022-07-01 00:00:00  0.000000     0.000000   0.000000
1 2022-07-01 01:00:00  0.021389     0.010694   0.010694
2 2022-07-01 02:00:00 -0.061712    -0.013441  -0.048271
3 2022-07-01 03:00:00 -1.105457    -0.286445  -0.819012
4 2022-07-01 04:00:00 -2.146765    -0.658509  -1.488256
```
### Получение данных в реальном времени (последние 5 минут на таймфрейме 1m без неполного бара)
```python
import datetime as dt
import live_trading_indicators as lti

utcnow = dt.datetime.utcnow()
print(f'Now is {utcnow} UTC')
indicators = lti.Indicators('binance', utcnow - dt.timedelta(minutes=3))
ohlcv = indicators.OHLCV('btcusdt', '1m')
print(ohlcv.pandas())
```
###### Результат:
```
                 time      open     high       low     close     volume
0 2022-11-04 09:25:00  20590.30  20600.0  20590.07  20596.97  157.41224
1 2022-11-04 09:26:00  20596.97  20599.6  20591.14  20592.13  136.98390
2 2022-11-04 09:27:00  20592.13  20595.0  20589.49  20590.87  196.36115
```
### Получение данных в реальном времени (последние 5 минут на таймфрейме 1m с неполным баром)

## Подробнее
Поддерживаются все типовые тамфреймы до 1 суток включительно: 1m, 5m, 15m, 30m, 1h, 2h, 4h, 6h, 8h, 12h, 1d.
### Источники данных и идентификаторы инструментов (symbols)
Текущая версия получает данные из одного источника - API криптобиржи binance. Названия инструментов соответствуют названиям на криптобирже. Для спотового рынка это просто название symbol, для фьючерсного USD-M с префиксом 'um/', для COIN-M префиксом 'cm/'. Примеры: btcusdt, um/btcusdt, cm/btcusdt_perp.
### Индикаторы
Реализованы следующие индикаторы:
- EMA(period, value='close')
- SMA(period, value='close')
- MACD(period_short, period_long, period_signal)
- RSI(period, value)
### Использование
Период может быть указан как при иницилизации Indicators, так и в параметрах индикатора. Тип данных при указании периода - datetime.date, datetime.datetime, numpy.datetime64, строка, или число в формате YYYYMMDD.
Существуют три стратегии указания периода времени.
#### 1. Период времени указывается при создании Indicators
После этого все индикаторы будут расчитываться и сохранятся в памяти на укаанный интервал. Значения индикаторов можно получить за любой период в пределах интервала, заданного для Indicators. При выходе за указанный интервал будет сгенерировано исключение ?.
##### Пример
```python
indicators = lti.Indicators('binance', 20220901, 20220931) # базовый период
ohlcv = indicators.OHLCV('um/ethusdt', '1h') # период не указан, используется базовый период
ma22 = indicators.SMA('um/ethusdt', '1h', 'close', 22, 20220905, 20220915) # период указан
ma15 = indicators.SMA('um/ethusdt', '1h', 'close', 15, 20220905, 20221015) # ОШИБКА, выход за границы базового периода
```
#### 2. Период времени не указывается при создании Indicators
В этом варианте, при получении данных индикатора, период надо указывать всегда. Период времени для расчета значений индикаторов определяется автоматически. При расширении интервала может происходит сброс кэша, это может замедлять работу.
##### Пример
```python
indicators = lti.Indicators('binance') # период не указан
ohlcv = indicators.OHLCV('um/ethusdt', '1h', 20220801, 20220815) # период указывать обязательно
ma22 = indicators.SMA('um/ethusdt', '1h', 'close', 22, 20220905, 20220915) # период указывать обязательно
```
#### 3. Режим реального времени
В этом варианте при создании Indicators указывается только начальная дата интервала. Данные будут получены по текущий момент времени.
#### Пример
